jQuery(function(i){var o=i("#woocommerce-order-items"),t=!1,d={handle_events:function(){o.on("click","button.configure_bundle",{action:"configure"},this.clicked_edit_button).on("click","button.edit_bundle",{action:"edit"},this.clicked_edit_button),i(document.body).on("click","input.bundled_product_checkbox",this.toggle_optional_item)},toggle_optional_item:function(e){var n=i(this),o=n.is(":checked"),n=n.closest(".details").find(".bundled_item_cart_content");o?n.show():n.hide()},clicked_edit_button:function(e){var n=i.WCBackboneModal.View.extend({addButton:d.clicked_done_button}),o=i(this).closest("tr.item").attr("data-order_item_id");return t=new n({target:"wc-modal-edit-bundle",string:{action:"configure"===e.data.action?wc_bundles_admin_order_params.i18n_configure:wc_bundles_admin_order_params.i18n_edit,item_id:o}}),d.populate_form(),!1},clicked_done_button:function(n){d.block(t.$el.find(".wc-backbone-modal-content"));var e=i.extend({},d.get_taxable_address(),{action:"woocommerce_edit_bundle_in_order",item_id:t._string.item_id,fields:t.$el.find("input, select, textarea").serialize(),dataType:"json",order_id:woocommerce_admin_meta_boxes.post_id,security:wc_bundles_admin_order_params.edit_bundle_nonce});i.post(woocommerce_admin_meta_boxes.ajax_url,e,function(e){e.result&&"success"===e.result?(o.find(".inside").empty(),o.find(".inside").append(e.html),o.trigger("wc_order_items_reloaded"),e.notes_html&&(i("ul.order_notes").empty(),i("ul.order_notes").append(i(e.notes_html).find("li"))),d.unblock(t.$el.find(".wc-backbone-modal-content")),d.block(o,{fadeIn:0}),setTimeout(function(){d.unblock(o)},250),t.closeButton(n)):(window.alert(e.error||wc_bundles_admin_order_params.i18n_validation_error),d.unblock(t.$el.find(".wc-backbone-modal-content")))})},populate_form:function(){d.block(t.$el.find(".wc-backbone-modal-content"));var e={action:"woocommerce_configure_bundle_order_item",item_id:t._string.item_id,dataType:"json",order_id:woocommerce_admin_meta_boxes.post_id,security:wc_bundles_admin_order_params.edit_bundle_nonce};i.post(woocommerce_admin_meta_boxes.ajax_url,e,function(e){e.result&&"success"===e.result?(t.$el.find("form").html(e.html),d.unblock(t.$el.find(".wc-backbone-modal-content"))):(window.alert(wc_bundles_admin_order_params.i18n_form_error),d.unblock(t.$el.find(".wc-backbone-modal-content")),t.$el.find(".modal-close").trigger("click"))})},get_taxable_address:function(){var e="",n="",o="",t="";return"shipping"===woocommerce_admin_meta_boxes.tax_based_on&&(e=i("#_shipping_country").val(),n=i("#_shipping_state").val(),o=i("#_shipping_postcode").val(),t=i("#_shipping_city").val()),"billing"!==woocommerce_admin_meta_boxes.tax_based_on&&e||(e=i("#_billing_country").val(),n=i("#_billing_state").val(),o=i("#_billing_postcode").val(),t=i("#_billing_city").val()),{country:e,state:n,postcode:o,city:t}},block:function(e,n){n=i.extend({},{message:null,overlayCSS:{background:"#fff",opacity:.6}},n||{});e.block(n)},unblock:function(e){e.unblock()}};d.handle_events()});